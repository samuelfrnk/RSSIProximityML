# -*- coding: utf-8 -*-
"""fitting_average.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1SzxBM-6C0sey9ZiAOfO29nI5HkdiPJvU
"""

import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from scipy.optimize import curve_fit

file_path = 'Experiment_3.csv'

df = pd.read_csv(file_path)

average_rssi_per_distance = df.groupby('Distance')['RSSI-Value'].mean().reset_index()

def exp_decay(distance, a, b, c):
    return a * np.exp(b * distance) + c

distances = average_rssi_per_distance['Distance']
rssi_values = average_rssi_per_distance['RSSI-Value']

initial_guesses = (rssi_values.max(), -1, rssi_values.min())

popt, _ = curve_fit(exp_decay, distances, rssi_values, p0=initial_guesses, maxfev=10000)

fitted_rssi_values = exp_decay(distances, *popt)

ss_res = np.sum((rssi_values - fitted_rssi_values) ** 2)
ss_tot = np.sum((rssi_values - np.mean(rssi_values)) ** 2)
r_squared = 1 - (ss_res / ss_tot)

# Plotting
plt.figure(figsize=(10, 6))
plt.scatter(distances, rssi_values, label='Average RSSI values')
plt.plot(distances, fitted_rssi_values, color='red', label='Fitted Exponential Decay Curve')
plt.xlabel('Distance')
plt.ylabel('RSSI Value')
plt.title(f'Average RSSI Value for Each Distance with Fitted Exponential Curve\n$R^2 = {r_squared:.4f}$')
plt.legend()
plt.grid(True)
plt.show()

print(f'R^2: {r_squared:.4f}')
